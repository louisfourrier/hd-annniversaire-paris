function do_add_item_menu(e){e=$.extend({extra_html:"",parent_id:0,id:!1},e);var t=$.trim(e.text),n=e.type,a=e.link?e.link.toString():"",i=e.parent_id,l=e.extra_html,d=e.id?e.id:$("#nestable .dd-item").length+1,s="";"post"==n||"category"==n?s='<a class="text-edit" title="'+I18n("button.edit")+'" target="_blank" href="'+e.url_edit+'" rel="1"><i class="fa fa-edit"></i></a>':"external"==n&&(s='<a class="text-edit" title="'+I18n("button.edit")+'" href="'+e.url_content+'" onclick="do_edit_menu(this); return false;" rel="1"><i class="fa fa-edit"></i></a>'),"true"==main_menus_panel.attr("data-fields_support")&&(s+='<a class="text-edit" title="'+I18n("button.settings")+'" href="'+e.url_content+'" onclick="do_settings_menu(this); return false;" rel="1"><i class="fa fa-cog"></i></a>');var r=$('<li class="dd-item dd3-item" data-type="'+n+'" data-id="'+d+'" data-parent="'+(i?i:"")+'"><div class="dd-handle dd3-handle"></div> <div class="dd3-content"><span>'+t+"</span> "+l+' <span class="label">'+n+"</span> "+s+' <a href="#" onclick="do_delete_menu(this); return false;" class="text-danger" title="'+I18n("button.delete")+'"><i class="fa fa-times-circle"></i></a> </div></li>');if(r.attr("data-fields",e.fields).attr("data-label",t).attr("data-link",a),i>0){var o=$("#nestable").find("*[data-id='"+i+"']");o.children(".dd-list").size()||o.append("<ol class='dd-list'></ol>"),o.children(".dd-list").append(r)}else $("#nestable",main_menus_panel).children(".dd-list").append(r);return $("a.text-danger, a.text-edit",r).tooltip(),d}function manage_add_links_to_menu(){main_menus_panel.find(".add_links_to_menu").click(function(){var e=$(this).parents(".panel");return e.find(":checkbox").filter(":checked").each(function(){var e=$(this).parents(".class_type").data(),t=$(this).parents(".class_slug").data();$(this).removeAttr("checked"),do_add_item_menu({type:e.type,link:$(this).val(),url_edit:t.post_link_edit,text:$(this).parent().text()})}),!1})}function manage_external_links(){main_menus_panel.find("form.form-custom-link").submit(function(){var e=$(this);return e.valid()?(do_add_item_menu({type:"external",link:e.find("#external_url").val(),text:e.find("#external_label").val(),url_content:RENDER_FORM}),e[0].reset(),setTimeout(function(){e.find("input:last").focus(),e.find(".has-error").removeClass("has-error").end().find("label.error").remove()},100),!1):!1}),main_menus_panel.find(".add_links_custom_to_menu").click(function(){var e=$(this).parents(".panel");return e.find(":checkbox").filter(":checked").each(function(){$(this).parents(".class_type").data(),$(this).parents(".class_slug").data();do_add_item_menu({type:"external",link:$(this).val(),text:$(this).parent().text(),url_content:RENDER_FORM}),$(this).removeAttr("checked")}),!1})}function do_delete_menu(e){var t=$(e).closest("li.dd-item").children("ol").size()?I18n("msg.remove_items_submenu"):I18n("msg.delete_item");confirm(t)&&$(e).closest("li.dd-item").remove()}function do_edit_menu(e){var t=$(e).closest("li");open_modal({title:"Edit Menu",url:$(e).attr("href"),mode:"ajax",callback:function(e){e.find(".panel-footer").html("<button type='submit' class='btn btn-primary'>Update</button>");var n=e.find("form");n.find("#external_label").val(t.attr("data-label")),n.find("#external_url").val(t.attr("data-link")),init_form_validations(n),n.submit(function(){return t.attr("data-label",n.find("#external_label").val()),t.attr("data-link",n.find("#external_url").val()),t.children(".dd3-content").children("span:first").html(n.find("#external_label").val()),e.modal("hide"),!1})}})}function do_settings_menu(link){var li=$(link).closest("li");open_modal({title:"Configuration Menu",url:$(link).attr("href")+"&custom_fields=true",mode:"ajax",callback:function(modal){var form=modal.find("form");setTimeout(function(){form.find(".translated-item").trigger("trans_integrate");var data=eval("("+(li.attr("data-fields")||"{}")+")");for(var key in data)data[key]&&form.find("[name='field_options["+key+"][values][]']").val(data[key]);init_form_validations(form)},300),form.submit(function(){if(!form.valid())return!1;form.find(".translated-item").trigger("trans_integrate");var e={},t=form.serializeObject().field_options;console.log(t);for(var n in t)e[n]=form.find("[name='field_options["+n+"][values][]']").val(),console.log("ssss",e);return li.attr("data-fields",JSON.stringify(e)),modal.modal("hide"),!1})}})}function render_menu(e){$.each(e,function(e,t){do_add_item_menu({id:t.id,type:t.type,link:t.link,url_edit:t.url_edit,text:t.label,parent_id:t.parent,url_content:RENDER_FORM,fields:t.fields})}),$("#nestable",main_menus_panel).nestable({maxDepth:20}).on("change",function(e){}),manage_external_links(main_menus_panel),manage_add_links_to_menu(),main_menus_panel.find(".disabled *").unbind().click(function(e){return!1}),$("#menu_items .tabs .nav").each(function(){1==$(this).children("li").size()&&$(this).children("li").remove()}),$("#menu_form").submit(function(){var e=0==$("#nestable").nestable("serialize").length?[]:$("#nestable").nestable("serialize");return showLoading(),$.post($(this).attr("action"),$.extend({menu_data:e},$(this).serializeObject()),function(e){e["new"]?location.href=e.redirect:(hideLoading(),main_menus_panel.flash_message(I18n("msg.updated_success"),"success"))}),!1})}