jQuery(function(a){function o(){a("#cp_photo").parent("a").find("span").html("Choose another photo");var o=a("#cp_target").find("#crop_image");1===o.length&&(a("#cp_img_path").val(o.attr("src")),o.cropper({aspectRatio:1,done:function(o){a("#ic_x").val(o.x),a("#ic_y").val(o.y),a("#ic_h").val(o.height),a("#ic_w").val(o.width)}}),a("#cp_accept").prop("disabled",!1).removeClass("disabled"),a("#cp_crop").css({width:"400px",margin:"0px auto"}),a("#cp_crop").find(".modal-body").css({"max-height":"400px",overflow:"auto"}),a("#cp_accept").unbind("click").on("click",function(){a("#modal_change_photo").modal("hide"),a("#cp_crop").ajaxForm({beforeSend:function(){showLoading()},success:function(o){hideLoading(),""!=o&&a("#modal_change_password .modal-body").flash_message(o),a("#user_image").html('<img class="img-thumbnail" src="'+o+"?r="+Math.random()+'"/>'),hideLoading()},error:function(){a.fn.alert({type:"error",content:"Internal Error",title:"Error"})}}).submit(),a("#cp_target").html("Use form below to upload file. Only image files."),a("#cp_photo").val("").parent("a").find("span").html("Select file"),a("#cp_accept").prop("disabled",!0).addClass("disabled"),a("#cp_img_path").val("")}))}var e=a("#user_form");e.validate(),a("#profie-form-ajax-password").ajaxForm({beforeSend:function(){showLoading()},success:function(o){a("#modal_change_password .modal-body").flash_message(o),hideLoading()}}),a("#cp_photo").on("click",function(){a.fn.upload_filemanager({formats:"image",selected:function(e){a("#cp_target").html("<img id='crop_image' src='"+e.url+"' >"),o()},user_pwd:"<%= current_user_pwd %>"})})});