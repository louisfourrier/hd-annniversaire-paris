!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){"use strict";var i=t(window),e=t(document),h=!0,a=!1,s=null,r=NaN,d=1/0,n="undefined",o="directive",g=".cropper",l=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,c=/^(x|y|width|height)$/,p=/^(naturalWidth|naturalHeight|width|height|aspectRatio|ratio)$/,f="cropper-modal",m="cropper-hidden",u="cropper-invisible",w="cropper-move",v="cropper-crop",x="cropper-disabled",b="mousedown touchstart",y="mousemove touchmove",$="mouseup mouseleave touchend touchleave touchcancel",D="wheel mousewheel DOMMouseScroll",W="resize"+g,H="dblclick",C="build"+g,k="built"+g,z="dragstart"+g,Y="dragmove"+g,X="dragend"+g,L=function(t){return"number"==typeof t},R=function(i,e){this.element=i,this.$element=t(i),this.defaults=t.extend({},R.DEFAULTS,t.isPlainObject(e)?e:{}),this.$original=s,this.ready=a,this.built=a,this.cropped=a,this.rotated=a,this.disabled=a,this.replaced=a,this.init()},_=Math.round,T=Math.sqrt,M=Math.min,I=Math.max,E=Math.abs,P=Math.sin,U=Math.cos,F=parseFloat;R.prototype={constructor:R,support:{canvas:t.isFunction(t("<canvas>")[0].getContext)},init:function(){var i=this.defaults;t.each(i,function(t,e){switch(t){case"aspectRatio":i[t]=E(F(e))||r;break;case"minWidth":case"minHeight":i[t]=E(F(e))||0;break;case"maxWidth":case"maxHeight":i[t]=E(F(e))||d}}),this.image={rotate:0},this.load()},load:function(){var i,e,s=this,r=this.$element,d=this.element,n=this.image;r.is("img")?e=r.attr("src"):r.is("canvas")&&this.support.canvas&&(e=d.toDataURL()),e&&(this.$clone&&this.$clone.remove(),this.replaced&&(this.replaced=a,n.rotate=0),this.$clone=i=t('<img src="'+e+'">'),i.one("load",function(){n.naturalWidth=this.naturalWidth||i.width(),n.naturalHeight=this.naturalHeight||i.height(),n.aspectRatio=n.naturalWidth/n.naturalHeight,s.url=e,s.ready=h,s.build()}),i.addClass(u).prependTo("body"))},build:function(){var i,a,s=this.$element,r=this.defaults;this.ready&&(this.built&&this.unbuild(),s.one(C,r.build),i=t.Event(C),s.trigger(i),i.isDefaultPrevented()||(this.$cropper=a=t(R.TEMPLATE),s.addClass(m),this.$clone.removeClass(u).prependTo(a),this.rotated||(this.$original=this.$clone.clone(),this.originalImage=t.extend({},this.image)),this.$container=s.parent(),this.$container.append(a),this.$canvas=a.find(".cropper-canvas"),this.$dragger=a.find(".cropper-dragger"),this.$viewer=a.find(".cropper-viewer"),r.autoCrop?this.cropped=h:this.$dragger.addClass(m),r.dragCrop&&this.setDragMode("crop"),r.modal&&this.$canvas.addClass(f),!r.dashed&&this.$dragger.find(".cropper-dashed").addClass(m),!r.movable&&this.$dragger.find(".cropper-face").addClass(m),!r.resizable&&this.$dragger.find(".cropper-line, .cropper-point").addClass(m),this.$scope=r.multiple?this.$cropper:e,this.addListeners(),this.initPreview(),this.built=h,this.update(),s.one(k,r.built),s.trigger(k)))},unbuild:function(){this.built&&(this.built=a,this.removeListeners(),this.$preview.empty(),this.$preview=s,this.$dragger=s,this.$canvas=s,this.$container=s,this.$cropper.remove(),this.$cropper=s)},update:function(t){this.initContainer(),this.initCropper(),this.initImage(),this.initDragger(),t?(this.setData(t,h),this.setDragMode("crop")):this.setData(this.defaults.data)},resize:function(){clearTimeout(this.resizing),this.resizing=setTimeout(t.proxy(this.update,this,this.getData()),200)},preview:function(){var i=this.image,e=this.dragger,h=i.width,a=i.height,s=e.left-i.left,r=e.top-i.top;this.$viewer.find("img").css({width:_(h),height:_(a),marginLeft:-_(s),marginTop:-_(r)}),this.$preview.each(function(){var i=t(this),d=i.width()/e.width;i.find("img").css({width:_(h*d),height:_(a*d),marginLeft:-_(s*d),marginTop:-_(r*d)})})},addListeners:function(){var e=this.defaults;this.$element.on(z,e.dragstart).on(Y,e.dragmove).on(X,e.dragend),this.$cropper.on(b,this._dragstart=t.proxy(this.dragstart,this)).on(H,this._dblclick=t.proxy(this.dblclick,this)),e.zoomable&&this.$cropper.on(D,this._wheel=t.proxy(this.wheel,this)),this.$scope.on(y,this._dragmove=t.proxy(this.dragmove,this)).on($,this._dragend=t.proxy(this.dragend,this)),i.on(W,this._resize=t.proxy(this.resize,this))},removeListeners:function(){var t=this.defaults;this.$element.off(z,t.dragstart).off(Y,t.dragmove).off(X,t.dragend),this.$cropper.off(b,this._dragstart).off(H,this._dblclick),t.zoomable&&this.$cropper.off(D,this._wheel),this.$scope.off(y,this._dragmove).off($,this._dragend),i.off(W,this._resize)},initPreview:function(){var i='<img src="'+this.url+'">';this.$preview=t(this.defaults.preview),this.$preview.html(i),this.$viewer.html(i)},initContainer:function(){var t=this.$container;this.container={width:I(t.width(),300),height:I(t.height(),150)}},initCropper:function(){var t,i=this.container,e=this.image;e.naturalWidth*i.height/e.naturalHeight-i.width>=0?(t={width:i.width,height:i.width/e.aspectRatio,left:0},t.top=(i.height-t.height)/2):(t={width:i.height*e.aspectRatio,height:i.height,top:0},t.left=(i.width-t.width)/2),this.$cropper.css({width:_(t.width),height:_(t.height),left:_(t.left),top:_(t.top)}),this.cropper=t},initImage:function(){var i=this.image,e=this.cropper,h={_width:e.width,_height:e.height,width:e.width,height:e.height,left:0,top:0,ratio:e.width/i.naturalWidth};this.defaultImage=t.extend({},i,h),i._width!==e.width||i._height!==e.height?t.extend(i,h):i=t.extend(h,i),this.image=i,this.renderImage()},renderImage:function(t){var i=this.image;"zoom"===t&&(i.left-=(i.width-i.oldWidth)/2,i.top-=(i.height-i.oldHeight)/2),i.left=M(I(i.left,i._width-i.width),0),i.top=M(I(i.top,i._height-i.height),0),this.$clone.css({width:_(i.width),height:_(i.height),marginLeft:_(i.left),marginTop:_(i.top)}),t&&(this.defaults.done(this.getData()),this.preview())},initDragger:function(){var i,e=this.defaults,h=this.cropper,a=e.aspectRatio||this.image.aspectRatio,s=this.image.ratio;i=h.height*a-h.width>=0?{height:h.width/a,width:h.width,left:0,top:(h.height-h.width/a)/2,maxWidth:h.width,maxHeight:h.width/a}:{height:h.height,width:h.height*a,left:(h.width-h.height*a)/2,top:0,maxWidth:h.height*a,maxHeight:h.height},i.minWidth=0,i.minHeight=0,e.aspectRatio?(isFinite(e.maxWidth)?(i.maxWidth=M(i.maxWidth,e.maxWidth*s),i.maxHeight=i.maxWidth/a):isFinite(e.maxHeight)&&(i.maxHeight=M(i.maxHeight,e.maxHeight*s),i.maxWidth=i.maxHeight*a),e.minWidth>0?(i.minWidth=I(0,e.minWidth*s),i.minHeight=i.minWidth/a):e.minHeight>0&&(i.minHeight=I(0,e.minHeight*s),i.minWidth=i.minHeight*a)):(i.maxWidth=M(i.maxWidth,e.maxWidth*s),i.maxHeight=M(i.maxHeight,e.maxHeight*s),i.minWidth=I(0,e.minWidth*s),i.minHeight=I(0,e.minHeight*s)),i.minWidth=M(i.maxWidth,i.minWidth),i.minHeight=M(i.maxHeight,i.minHeight),i.height*=.8,i.width*=.8,i.left=(h.width-i.width)/2,i.top=(h.height-i.height)/2,i.oldLeft=i.left,i.oldTop=i.top,this.defaultDragger=i,this.dragger=t.extend({},i)},renderDragger:function(){var t=this.dragger,i=this.cropper;t.width>t.maxWidth?(t.width=t.maxWidth,t.left=t.oldLeft):t.width<t.minWidth&&(t.width=t.minWidth,t.left=t.oldLeft),t.height>t.maxHeight?(t.height=t.maxHeight,t.top=t.oldTop):t.height<t.minHeight&&(t.height=t.minHeight,t.top=t.oldTop),t.left=M(I(t.left,0),i.width-t.width),t.top=M(I(t.top,0),i.height-t.height),t.oldLeft=t.left,t.oldTop=t.top,this.dragger=t,this.defaults.done(this.getData()),this.$dragger.css({width:_(t.width),height:_(t.height),left:_(t.left),top:_(t.top)}),this.preview()},reset:function(i){this.cropped&&(i&&(this.defaults.data={}),this.image=t.extend({},this.defaultImage),this.renderImage(),this.dragger=t.extend({},this.defaultDragger),this.setData(this.defaults.data))},clear:function(){this.cropped&&(this.cropped=a,this.setData({x:0,y:0,width:0,height:0}),this.$canvas.removeClass(f),this.$dragger.addClass(m))},destroy:function(){var t=this.$element;this.ready&&(this.unbuild(),t.removeClass(m).removeData("cropper"),this.rotated&&t.replaceWith(this.$original))},replace:function(i,e){var s,r=this,d=this.$element,n=this.element;i&&i!==this.url&&(e||(this.rotated=a,this.replaced=h),d.is("img")?(d.attr("src",i),this.load()):d.is("canvas")&&this.support.canvas&&(s=n.getContext("2d"),t('<img src="'+i+'">').one("load",function(){n.width=this.width,n.height=this.height,s.clearRect(0,0,n.width,n.height),s.drawImage(this,0,0),r.load()})))},setData:function(i,e){var h=this.cropper,a=this.dragger,r=this.image,d=this.defaults.aspectRatio;this.built&&typeof i!==n&&((i===s||t.isEmptyObject(i))&&(a=t.extend({},this.defaultDragger)),t.isPlainObject(i)&&!t.isEmptyObject(i)&&(e||(this.defaults.data=i),i=this.transformData(i),L(i.x)&&i.x<=h.width-r.left&&(a.left=i.x+r.left),L(i.y)&&i.y<=h.height-r.top&&(a.top=i.y+r.top),d?L(i.width)&&i.width<=a.maxWidth&&i.width>=a.minWidth?(a.width=i.width,a.height=a.width/d):L(i.height)&&i.height<=a.maxHeight&&i.height>=a.minHeight&&(a.height=i.height,a.width=a.height*d):(L(i.width)&&i.width<=a.maxWidth&&i.width>=a.minWidth&&(a.width=i.width),L(i.height)&&i.height<=a.maxHeight&&i.height>=a.minHeight&&(a.height=i.height))),this.dragger=a,this.renderDragger())},getData:function(){var t=this.dragger,i=this.image,e={};return this.built&&(e={x:t.left-i.left,y:t.top-i.top,width:t.width,height:t.height},e=this.transformData(e,h)),e},transformData:function(i,e){var h=this.image.ratio,a={};return t.each(i,function(t,i){i=F(i),c.test(t)&&!isNaN(i)&&(a[t]=e?_(i/h):i*h)}),a},setAspectRatio:function(t){var i="auto"===t;t=F(t),(i||!isNaN(t)&&t>0)&&(this.defaults.aspectRatio=i?r:t,this.built&&(this.initDragger(),this.renderDragger()))},getImageData:function(){var i={};return this.ready&&t.each(this.image,function(t,e){p.test(t)&&(i[t]=e)}),i},getDataURL:function(i,e){var h=t("<canvas>")[0],a=this.getData(),s="";return this.cropped&&this.support.canvas&&(h.width=a.width,h.height=a.height,h.getContext("2d").drawImage(this.$clone[0],a.x,a.y,a.width,a.height,0,0,a.width,a.height),s=h.toDataURL(i,e)),s},setDragMode:function(t){var i=this.$canvas,e=this.defaults,s=a,r=a;if(this.built&&!this.disabled){switch(t){case"crop":e.dragCrop&&(s=h,i.data(o,t));break;case"move":e.movable&&(r=h,i.data(o,t));break;default:i.removeData(o)}i.toggleClass(v,s).toggleClass(w,r)}},enable:function(){this.built&&(this.disabled=a,this.$cropper.removeClass(x))},disable:function(){this.built&&(this.disabled=h,this.$cropper.addClass(x))},rotate:function(t){var i=this.image;t=F(t)||0,this.built&&0!==t&&!this.disabled&&this.defaults.rotatable&&this.support.canvas&&(this.rotated=h,t=i.rotate=(i.rotate+t)%360,this.replace(this.getRotatedDataURL(t),!0))},getRotatedDataURL:function(i){var e=this.$original.clone(),h=t("<canvas>")[0],a=h.getContext("2d"),s=i*Math.PI/180,r=E(i)%180,d=r>90?180-r:r,n=d*Math.PI/180,o=this.originalImage,g=o.naturalWidth,l=o.naturalHeight,c=E(g*U(n)+l*P(n)),p=E(g*P(n)+l*U(n));return h.width=c,h.height=p,a.save(),a.translate(c/2,p/2),a.rotate(s),e.addClass(u).prependTo(this.$cropper),a.drawImage(e[0],-g/2,-l/2,g,l),a.restore(),h.toDataURL()},zoom:function(t){var i,e,h,a=this.image;t=F(t),this.built&&t&&!this.disabled&&this.defaults.zoomable&&(i=a.width*(1+t),e=a.height*(1+t),h=i/a._width,h>10||(1>h&&(i=a._width,e=a._height),this.setDragMode(1>=h?"crop":"move"),a.oldWidth=a.width,a.oldHeight=a.height,a.width=i,a.height=e,a.ratio=a.width/a.naturalWidth,this.renderImage("zoom")))},dblclick:function(){this.disabled||this.setDragMode(this.$canvas.hasClass(v)?"move":"crop")},wheel:function(t){var i,e=t.originalEvent,h=117.25,a=5,s=166.66665649414062,r=.1;this.disabled||(t.preventDefault(),e.deltaY?(i=e.deltaY,i=i%a===0?i/a:i%h===0?i/h:i/s):i=e.wheelDelta?-e.wheelDelta/120:e.detail?e.detail/3:0,this.zoom(i*r))},dragstart:function(i){var e,s,r,d=i.originalEvent.touches,n=i;if(!this.disabled){if(d){if(r=d.length,r>1){if(!this.defaults.zoomable||2!==r)return;n=d[1],this.startX2=n.pageX,this.startY2=n.pageY,e="zoom"}n=d[0]}if(e=e||t(n.target).data(o),l.test(e)){if(i.preventDefault(),s=t.Event(z),this.$element.trigger(s),s.isDefaultPrevented())return;this.directive=e,this.cropping=a,this.startX=n.pageX,this.startY=n.pageY,"crop"===e&&(this.cropping=h,this.$canvas.addClass(f))}}},dragmove:function(i){var e,h,a=i.originalEvent.touches,s=i;if(!this.disabled){if(a){if(h=a.length,h>1){if(!this.defaults.zoomable||2!==h)return;s=a[1],this.endX2=s.pageX,this.endY2=s.pageY}s=a[0]}if(this.directive){if(i.preventDefault(),e=t.Event(Y),this.$element.trigger(e),e.isDefaultPrevented())return;this.endX=s.pageX,this.endY=s.pageY,this.dragging()}}},dragend:function(i){var e;if(!this.disabled&&this.directive){if(i.preventDefault(),e=t.Event(X),this.$element.trigger(e),e.isDefaultPrevented())return;this.cropping&&(this.cropping=a,this.$canvas.toggleClass(f,this.cropped&&this.defaults.modal)),this.directive=""}},dragging:function(){var t,i=this.directive,e=this.image,s=this.cropper,r=s.width,d=s.height,n=this.dragger,o=n.width,g=n.height,l=n.left,c=n.top,p=l+o,f=c+g,u=h,w=this.defaults,v=w.aspectRatio,x={x:this.endX-this.startX,y:this.endY-this.startY};switch(v&&(x.X=x.y*v,x.Y=x.x/v),i){case"all":l+=x.x,c+=x.y;break;case"e":if(x.x>=0&&(p>=r||v&&(0>=c||f>=d))){u=a;break}o+=x.x,v&&(g=o/v,c-=x.Y/2),0>o&&(i="w",o=0);break;case"n":if(x.y<=0&&(0>=c||v&&(0>=l||p>=r))){u=a;break}g-=x.y,c+=x.y,v&&(o=g*v,l+=x.X/2),0>g&&(i="s",g=0);break;case"w":if(x.x<=0&&(0>=l||v&&(0>=c||f>=d))){u=a;break}o-=x.x,l+=x.x,v&&(g=o/v,c+=x.Y/2),0>o&&(i="e",o=0);break;case"s":if(x.y>=0&&(f>=d||v&&(0>=l||p>=r))){u=a;break}g+=x.y,v&&(o=g*v,l-=x.X/2),0>g&&(i="n",g=0);break;case"ne":if(v){if(x.y<=0&&(0>=c||p>=r)){u=a;break}g-=x.y,c+=x.y,o=g*v}else x.x>=0?r>p?o+=x.x:x.y<=0&&0>=c&&(u=a):o+=x.x,x.y<=0?c>0&&(g-=x.y,c+=x.y):(g-=x.y,c+=x.y);0>g&&(i="sw",g=0,o=0);break;case"nw":if(v){if(x.y<=0&&(0>=c||0>=l)){u=a;break}g-=x.y,c+=x.y,o=g*v,l+=x.X}else x.x<=0?l>0?(o-=x.x,l+=x.x):x.y<=0&&0>=c&&(u=a):(o-=x.x,l+=x.x),x.y<=0?c>0&&(g-=x.y,c+=x.y):(g-=x.y,c+=x.y);0>g&&(i="se",g=0,o=0);break;case"sw":if(v){if(x.x<=0&&(0>=l||f>=d)){u=a;break}o-=x.x,l+=x.x,g=o/v}else x.x<=0?l>0?(o-=x.x,l+=x.x):x.y>=0&&f>=d&&(u=a):(o-=x.x,l+=x.x),x.y>=0?d>f&&(g+=x.y):g+=x.y;0>o&&(i="ne",g=0,o=0);break;case"se":if(v){if(x.x>=0&&(p>=r||f>=d)){u=a;break}o+=x.x,g=o/v}else x.x>=0?r>p?o+=x.x:x.y>=0&&f>=d&&(u=a):o+=x.x,x.y>=0?d>f&&(g+=x.y):g+=x.y;0>o&&(i="nw",g=0,o=0);break;case"move":e.left+=x.x,e.top+=x.y,this.renderImage("move"),u=a;break;case"zoom":w.zoomable&&(this.zoom(function(t,i,e,h,a,s){return(T(a*a+s*s)-T(e*e+h*h))/T(t*t+i*i)}(e.width,e.height,E(this.startX-this.startX2),E(this.startY-this.startY2),E(this.endX-this.endX2),E(this.endY-this.endY2))),this.endX2=this.startX2,this.endY2=this.startY2);break;case"crop":x.x&&x.y&&(t=this.$cropper.offset(),l=this.startX-t.left,c=this.startY-t.top,o=n.minWidth,g=n.minHeight,x.x>0?x.y>0?i="se":(i="ne",c-=g):x.y>0?(i="sw",l-=o):(i="nw",l-=o,c-=g),this.cropped||(this.cropped=h,this.$dragger.removeClass(m)))}u&&(n.width=o,n.height=g,n.left=l,n.top=c,this.directive=i,this.renderDragger()),this.startX=this.endX,this.startY=this.endY}},R.TEMPLATE=function(t,i){return i=i.split(","),t.replace(/\d+/g,function(t){return i[t]})}('<0 6="5-container"><0 6="5-canvas"></0><0 6="5-dragger"><1 6="5-viewer"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-face" 3-2="all"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>',"div,span,directive,data,point,cropper,class,line,dashed"),R.DEFAULTS={aspectRatio:"auto",data:{},done:t.noop,preview:"",multiple:a,autoCrop:h,dragCrop:h,dashed:h,modal:h,movable:h,resizable:h,zoomable:h,rotatable:h,minWidth:0,minHeight:0,maxWidth:d,maxHeight:d,build:s,built:s,dragstart:s,dragmove:s,dragend:s},R.setDefaults=function(i){t.extend(R.DEFAULTS,i)},R.other=t.fn.cropper,t.fn.cropper=function(i){var e,h=[].slice.call(arguments,1);return this.each(function(){var a,s=t(this),r=s.data("cropper");r||s.data("cropper",r=new R(this,i)),"string"==typeof i&&t.isFunction(a=r[i])&&(e=a.apply(r,h))}),typeof e!==n?e:this},t.fn.cropper.Constructor=R,t.fn.cropper.setDefaults=R.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=R.other,this}});